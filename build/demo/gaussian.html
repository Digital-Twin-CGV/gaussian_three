<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>3D Gaussian Splat Demo - Garden</title>
    <script type="text/javascript" src="js/util.js"></script>
    <script type="importmap">
      {
        "imports": {
          "three": "./lib/three.module.js",
          "@mkkellogg/gaussian-splats-3d": "./lib/gaussian-splats-3d.module.js"
        }
      }
    </script>
    <style>
      body {
        margin: 0px;
      }

      .gaussian_container {
        height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .gaussian_statebar {
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #fff2c5;
        padding: 20px;
      }

      .gaussian_complete {
        position: absolute;
        right: 0;
        display: flex;
      }

      .gaussian_complete_btn {
        padding: 10px 15px;
        margin: 0 10px;
        background-color: #c0c0c0;
        border-radius: 20px;
        cursor: pointer;
      }

      #gaussian_complete_btn_cancel {
        background-color: #ff9090;
      }
    </style>
  </head>

  <body>
    <div class="gaussian_container">
      <div class="gaussian_statebar">
        <div>드래그하여 정확한 위치를 선택해주세요</div>
        <div class="gaussian_complete">
          <div
            class="gaussian_complete_btn"
            id="gaussian_complete_btn_cancel"
            onClick="openDemo('minimap')"
          >
            취소
          </div>
          <div class="gaussian_complete_btn" onClick="openDemo('driving')">
            선택 완료
          </div>
        </div>
      </div>
    </div>
    <script type="module">
      import * as GaussianSplats3D from "@mkkellogg/gaussian-splats-3d";
      import * as THREE from "three";

      const urlParams = new URLSearchParams(window.location.search);
      const mode = parseInt(urlParams.get("mode")) || 0;

      const viewer = new GaussianSplats3D.Viewer({
        cameraUp: [0, -1, -0.54],
        initialCameraPosition: [-3.15634, -0.16946, -0.51552],
        initialCameraLookAt: [1.52976, 2.27776, 1.65898],
        sphericalHarmonicsDegree: 2,
      });

      // Adding two splat scenes as described
      viewer.addSplatScenes([{
        'path': "assets/data/garden/test1.splat",
        'splatAlphaRemovalThreshold': 20
      },
      {
        'path': "assets/data/garden/test2.splat",
        'rotation': [-0.14724434, -0.0761755, 0.1410657, 0.976020],
        'scale': [1.5, 1.5, 1.5],
        'position': [-3, -2, -3.2]
      }])
      .then(() => {
        viewer.start();
      });

      // 카메라 이동 속도 설정
      const moveSpeed = 0.1;


      document.addEventListener('keydown', function(event) {
      // 카메라 이동 벡터 초기화
      let moveDirection = new THREE.Vector3(0, 0, 0);

      // W, S, E, Q, A, D 키 입력에 따른 카메라 이동
      if (event.key === 'w' || event.key === 'W') {
          moveDirection.z = -moveSpeed;  // W: 앞으로
      } else if (event.key === 's' || event.key === 'S') {
          moveDirection.z = moveSpeed;   // S: 뒤로
      } else if (event.key === 'e' || event.key === 'E') {
          moveDirection.y = moveSpeed;   // E: 위로
      } else if (event.key === 'q' || event.key === 'Q') {
          moveDirection.y = -moveSpeed;  // Q: 아래로
      } else if (event.key === 'a' || event.key === 'A') {
          moveDirection.x = -moveSpeed;  // A: 왼쪽
      } else if (event.key === 'd' || event.key === 'D') {
          moveDirection.x = moveSpeed;   // D: 오른쪽
      }

      // 이동 벡터를 카메라의 로컬 좌표계로 변환
      moveDirection.applyQuaternion(viewer.camera.quaternion);

      // 변환된 벡터를 카메라에 적용
      viewer.camera.position.add(moveDirection);
      });


      //카메라 이동 함수
      document.addEventListener('keydown', function(event) {
          // 카메라 이동 벡터 초기화
          let moveDirection = new THREE.Vector3(0, 0, 0);

          // W, S, E, Q, A, D 키 입력에 따른 카메라 이동
          if (event.key === 'w' || event.key === 'W') {
              moveDirection.z = -moveSpeed;  // W: 앞으로
          } else if (event.key === 's' || event.key === 'S') {
              moveDirection.z = moveSpeed;   // S: 뒤로
          } else if (event.key === 'e' || event.key === 'E') {
              moveDirection.y = moveSpeed;   // E: 위로
          } else if (event.key === 'q' || event.key === 'Q') {
              moveDirection.y = -moveSpeed;  // Q: 아래로
          } else if (event.key === 'a' || event.key === 'A') {
              moveDirection.x = -moveSpeed;  // A: 왼쪽
          } else if (event.key === 'd' || event.key === 'D') {
              moveDirection.x = moveSpeed;   // D: 오른쪽
          }

          // 이동 벡터를 카메라에 적용
          viewer.camera.position.add(moveDirection);
      });
    </script>
    <script>
      function openDemo(page) {
        let url = page + ".html";
        window.location = url;
      }
    </script>
  </body>
</html>
